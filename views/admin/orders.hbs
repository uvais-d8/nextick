<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WATCHES PREMIUM</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <link rel="shortcut icon" type="image/png" href="/assets/img/favicon.png">

    <link rel="stylesheet" href="/admin/products.css">
</head>

<body>
    <div class="dashboard">
        <aside class="sidebar">
            <div class="logo">WATCH PREMIUM</div>
            <nav>
                <a class="a" href="/admin/dashboard">
                    <div class="nav-item">Dashboard</div>
                </a>
                <a class="a" href="/admin/userpage">
                    <div class="nav-item">Users</div>
                    <a class="a" href="/admin/products">
                        <div class="nav-item">Products</div>
                    </a>
                    <a class="a" href="/admin/category">
                        <div class="nav-item">Category</div>
                    </a>
                    <a class="a" href="/admin/orders">
                        <div class="nav-item active">Orders</div>
                    </a>
                    <a class="a" href="/admin/inventory">
                        <div class="nav-item">Inventory</div>
                    </a>
                    <a class="a" href="/admin/coupon">
                        <div class="nav-item">coupons</div>
                    </a>
                    <a class="a" href="/admin/dashboard">
                        <div class="nav-item">Offers</div>
                    </a>
                    <a class="a" href="/admin/dashboard">
                        <div class="nav-item">Sales Report</div>
                    </a>
            </nav>
        </aside>
        <main class="main-content">
            <div class="controls">
                <h1 style="font-size:43px;">ORDERS MANAGEMENT</h1>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Delivery Address</th>
                        <th>Order Date</th>
                        <th>Products</th>
                        <th>Total Price</th>
                        <th>Quantity</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {{#each orders}}
                    {{#each items}}
                    <tr>
                        <td>{{../shippingAddress.firstname}} {{../shippingAddress.lastname}}</td>
                        <td>{{../shippingAddress.address}}</td> <!-- Access address from shippingAddress -->
                        <td>{{formatDate ../time}}</td> <!-- Use the formatDate helper here -->
                        <td> {{productId.name}}</td>
                        <td>$ {{total}}</td>
                        <td>{{quantity}}</td>
                        <td>
                            <form method="POST" action="/admin/updatestatus">
                                <div class="status-container" data-status="{{status}}">
                                    <select id="statusSelect{{_id}}" class="statusSelect"
                                        style="width:140px;color: rgb(255, 255, 255); background-color: rgba(26, 45, 120, 0.752); border-color: rgb(0, 0, 0)"
                                        name="status" id="statusSelect" required onchange="this.form.submit()">
                                        <option value=""><b>{{status}}</b></option>
                                        <option value="scheduled"><b>Scheduled</b></option>
                                        <option value="pending"><b>Pending</b></option>
                                        <option value="delivered"><b>Delivered</b></option>
                                        <option value="shipped"><b>Shipped</b></option>
                                        <option value="canceled"><b>Canceled</b></option>
                                    </select>
                                    <input type="hidden" name="orderId" value="{{../_id}}">
                                    <input type="hidden" name="itemId" value="{{_id}}"> <!-- Pass itemId -->
                                    <p id="statusWarning{{_id}}" class="statusWarning"
                                        style="display: none; color: rgb(255, 17, 0);font-size:13px">
                                        order already delivered
                                    </p>
                            </form>

                            <script>
                                // Function to disable status change if the current status is 'Delivered'
                                document.addEventListener('DOMContentLoaded', function () {
                                    // Select all status containers (assuming a class is applied for grouping them)
                                    var statusContainers = document.querySelectorAll('.status-container');

                                    statusContainers.forEach(function (container) {
                                        // Get the current status and select elements within each container
                                        var currentStatus = container.getAttribute('data-status'); // Retrieve status from a data attribute
                                        var statusSelect = container.querySelector('.statusSelect'); // Target select within this container
                                        var statusWarning = container.querySelector('.statusWarning'); // Target warning within this container

                                        // If current status is 'Delivered', disable the select and show warning
                                        if (currentStatus === "delivered") {
                                            statusSelect.disabled = true;
                                            statusWarning.style.display = 'block';
                                        }
                                    });
                                });

                            </script>
                        </td>
                        <td>
                            <form action="/admin/orders/cancel" method="POST">
                                <input type="hidden" name="orderId" value="{{../_id}}">
                                <input type="hidden" name="itemId" value="{{_id}}"> <!-- Pass itemId -->
                                <button
                                    style="color:rgb(246, 246, 246); background-color: rgba(189, 4, 4, 0.93); height:40px; font-size:12px"
                                    class="action-button unblock-button" {{#if (eq status "delivered"
                                    )}}disabled{{/if}}>
                                    <b>CANCEL</b>
                                </button>

                            </form>
                        </td>
                    </tr>

                    {{/each}}
                    {{/each}}
                </tbody>
            </table>

            <div style="margin-left: 44%;" class="pagination">
                <button style="color:white;background-color: rgb(10, 15, 27);" class="pagination-button">&lt;</button>
                <span style="margin-top: 8px;">swipe</span>
                <button style="color:white;background-color: rgb(10, 15, 27);" class="pagination-button">&gt;</button>
            </div>
        </main>
    </div>
</body>

</html>